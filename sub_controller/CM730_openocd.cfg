# make sure init is called
echo "** init Started **"
init


# reset target and call any init scripts
echo "** reset init Started **"
reset init


# programming phase
echo "** programming Started **"

set file1 "OpenCM9.04_BOOTLOADER_2_6_FIRMWARE_20140327.bin"

set base1 "0x08000000"

stm32f1x unlock 0

flash protect 0 0 127 off

reset halt

flash write_image erase $file1 $base1

# verify phase
echo "** verify Started **"

verify_image $file1 $base1


# programming phase
echo "** programming Started **"

set file2 "CM730.bin"

set base2 "0x08003000"

flash write_image erase $file2 $base2

# verify phase
echo "** verify Started **"

verify_image $file2 $base2

# run program

reset init

reset run
